<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }} Remote Console</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <script defer src="{{ url_for('static', filename='js/app.js') }}"></script>
  </head>
  <body>
    <div class="loading-screen" id="loading-screen" aria-live="polite">
      <img
        src="{{ url_for('static', filename='img/onics-seal.svg') }}"
        alt="Wireless Autonomous Terrestrial Navigation Experiment seal"
        class="loading-logo"
      />
      <div class="loading-text">
        <div class="loading-title">Booting ONICS-T Console</div>
        <div class="loading-subtitle">Synchronizing tailnet telemetry...</div>
      </div>
    </div>

    <div class="modal" id="login-modal" aria-hidden="true">
      <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="login-title">
        <h2 id="login-title">SSH Login Required</h2>
        <p class="modal__message" id="login-message">
          SSH authentication is missing. Complete an interactive login to continue.
        </p>
        <div class="modal__command">
          <span>Command</span>
          <code id="login-command">ssh user@host</code>
        </div>
        <div class="modal__command">
          <span>Setup key</span>
          <code id="login-setup-command">ssh-copy-id user@host</code>
        </div>
        <div class="modal__command">
          <span>Create key</span>
          <code id="login-keygen-command">ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N ""</code>
        </div>
        <div class="button-row">
          <button class="btn btn--engage" id="login-open-btn">Open SSH Login</button>
          <button class="btn btn--ghost" id="login-dismiss-btn">Dismiss</button>
        </div>
      </div>
    </div>

    <main class="shell" aria-live="polite">
      <header class="shell__header">
        <div class="shell__brand">
          <img
            src="{{ url_for('static', filename='img/onics-seal.svg') }}"
            alt="ONICS seal"
            class="shell__logo"
          />
          <div class="shell__brand-text">
            <p class="shell__eyebrow">Remote Console</p>
            <h1 class="shell__title" id="app-title">{{ title }}</h1>
            <p class="shell__meta" id="app-meta">Awaiting link...</p>
          </div>
        </div>
        <div class="shell__status" id="connection-pill">LINK: INIT</div>
      </header>

      <section class="grid grid--primary">
        <article class="panel">
          <header class="panel__header">
            <h2>Command Deck</h2>
            <p>Send guarded engage/disengage commands.</p>
          </header>
          <div class="panel__body">
            <div class="button-row">
              <button class="btn btn--engage" id="engage-btn">ENGAGE</button>
              <button class="btn btn--disengage" id="disengage-btn">DISENGAGE</button>
            </div>
            <div class="button-row button-row--secondary">
              <button class="btn btn--ghost" id="clear-btn">Clear Logs</button>
            </div>
            <div class="status-strip" id="onics-state">
              <span class="status-strip__label">State</span>
              <strong class="status-strip__value">IDLE</strong>
              <span class="status-strip__meta" id="onics-runtime">No runtime telemetry.</span>
            </div>
          </div>
        </article>

        <article class="panel">
          <header class="panel__header">
            <h2>Telemetry Log</h2>
            <p>Live stdout/stderr stream (most recent first).</p>
          </header>
          <div class="panel__body panel__body--logs">
            <div class="log-view" id="log-view" role="log" aria-live="polite"></div>
          </div>
        </article>
      </section>

      <section class="toolbar-grid">
        <article class="toolbar" id="health-panel">
          <div class="toolbar__header">
            <h2>Tailnet Health</h2>
            <p>MagicDNS + SSH readiness.</p>
          </div>
          <div class="toolbar__items">
            <div class="health-card" id="tailscale-card">
              <h3>Tailscale</h3>
              <p class="health-card__value" id="tailscale-status">UNKNOWN</p>
              <p class="health-card__meta" id="tailscale-meta">Awaiting signal.</p>
            </div>
            <div class="health-card" id="dns-card">
              <h3>MagicDNS</h3>
              <p class="health-card__value" id="dns-status">UNKNOWN</p>
              <p class="health-card__meta" id="dns-meta">Awaiting DNS resolution.</p>
            </div>
            <div class="health-card" id="tcp-card">
              <h3>SSH Probe</h3>
              <p class="health-card__value" id="tcp-status">UNKNOWN</p>
              <p class="health-card__meta" id="tcp-meta">Awaiting TCP telemetry.</p>
            </div>
          </div>
        </article>

        <article class="panel">
          <header class="panel__header">
            <h2>Autopilot Health</h2>
            <p>Service status and system telemetry from the flight stack host.</p>
          </header>
          <div class="panel__body">
            <div class="health-grid">
              <div class="health-card" id="arducopter-card">
                <h3>Arducopter</h3>
                <p class="health-card__value" id="arducopter-status">UNKNOWN</p>
                <p class="health-card__meta" id="arducopter-meta">Awaiting status.</p>
              </div>
              <div class="health-card" id="mavproxy-card">
                <h3>MAVProxy</h3>
                <p class="health-card__value" id="mavproxy-status">UNKNOWN</p>
                <p class="health-card__meta" id="mavproxy-meta">Awaiting status.</p>
              </div>
              <div class="health-card" id="uplink-card">
                <h3>Uplink</h3>
                <p class="health-card__value" id="uplink-status">UNKNOWN</p>
                <p class="health-card__meta" id="uplink-meta">Awaiting status.</p>
              </div>
            </div>
            <div class="health-grid">
              <div class="health-card" id="system-load-card">
                <h3>System Load</h3>
                <p class="health-card__value" id="system-load">-</p>
                <p class="health-card__meta" id="system-load-meta">Awaiting telemetry.</p>
              </div>
              <div class="health-card" id="system-memory-card">
                <h3>Memory</h3>
                <p class="health-card__value" id="system-memory">-</p>
                <p class="health-card__meta" id="system-memory-meta">Awaiting telemetry.</p>
              </div>
              <div class="health-card" id="system-disk-card">
                <h3>Disk</h3>
                <p class="health-card__value" id="system-disk">-</p>
                <p class="health-card__meta" id="system-disk-meta">Awaiting telemetry.</p>
              </div>
              <div class="health-card" id="system-uptime-card">
                <h3>Uptime</h3>
                <p class="health-card__value" id="system-uptime">-</p>
                <p class="health-card__meta" id="system-uptime-meta">Awaiting telemetry.</p>
              </div>
            </div>
          </div>
        </article>

        <article class="panel">
          <header class="panel__header">
            <h2>Vehicle Telemetry</h2>
            <p>Parsed milestones from the ONICS-T log stream.</p>
          </header>
          <div class="panel__body">
            <div class="health-grid">
              <div class="health-card" id="tracking-card">
                <h3>Tracking Confidence</h3>
                <p class="health-card__value" id="tracking-confidence">Awaiting telemetry</p>
                <p class="health-card__meta" id="tracking-meta">No tracking updates yet.</p>
              </div>
              <div class="health-card" id="startup-card">
                <div class="health-card__header">
                  <h3>Startup Stage</h3>
                  <p class="startup-fails__value" id="startup-fails">0</p>
                </div>
                <p class="health-card__value" id="startup-stage">Awaiting telemetry</p>
                <p class="health-card__meta" id="startup-meta">No startup milestones yet.</p>
                <p class="health-card__meta startup-fails__label">Restart fails</p>
              </div>
              <div class="health-card" id="autopilot-card">
                <h3>Autopilot Alerts</h3>
                <p class="health-card__value" id="autopilot-alert">Awaiting telemetry</p>
                <p class="health-card__meta" id="autopilot-meta">No autopilot alerts yet.</p>
              </div>
            </div>
          </div>
        </article>

      </section>
    </main>
  </body>
</html>
