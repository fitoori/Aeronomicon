<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <meta name="theme-color" content="#0a120f" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="ONICS Console" />
    <title>{{ title }} Remote Console</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='img/onics-seal.svg') }}" />
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/onics-seal.svg') }}" />
    <link rel="manifest" href="{{ url_for('static', filename='manifest.webmanifest') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
    <script defer src="{{ url_for('static', filename='js/app.js') }}"></script>
  </head>
  <body>
    <div class="loading-screen" id="loading-screen" aria-live="polite">
      <img
        src="{{ url_for('static', filename='img/onics-seal.svg') }}"
        alt="Wireless Autonomous Terrestrial Navigation Experiment seal"
        class="loading-logo"
      />
      <p class="loading-subtitle">
        No refresh needed — this page will update automatically once a link is established.
      </p>
    </div>

    <div class="reboot-screen hidden" id="reboot-screen" aria-live="polite" aria-hidden="true">
      <img
        src="{{ url_for('static', filename='img/onics-seal.svg') }}"
        alt="Wireless Autonomous Terrestrial Navigation Experiment seal"
        class="loading-logo"
      />
      <p class="loading-title">Link offline</p>
      <p class="loading-subtitle">
        No refresh needed — this page will update automatically once a link is established.
      <p class="loading-title">Vehicle restarting</p>
      <p class="loading-subtitle">
        Do not refresh this page. Wait for the vehicle to come back online.
      </p>
    </div>

    <div class="modal" id="login-modal" aria-hidden="true">
      <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="login-title">
        <h2 id="login-title">SSH Login Required</h2>
        <p class="modal__message" id="login-message">
          SSH authentication is missing. Complete an interactive login to continue.
        </p>
        <div class="modal__command">
          <span>Command</span>
          <code id="login-command">ssh user@host</code>
        </div>
        <div class="modal__command">
          <span>Setup key</span>
          <code id="login-setup-command">ssh-copy-id user@host</code>
        </div>
        <div class="modal__command">
          <span>Create key</span>
          <code id="login-keygen-command">ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519 -N ""</code>
        </div>
        <div class="button-row">
          <button class="btn btn--engage" id="login-open-btn">Open SSH Login</button>
          <button class="btn btn--ghost" id="login-dismiss-btn">Dismiss</button>
        </div>
      </div>
    </div>

    <main class="shell" aria-live="polite">
      <header class="shell__header">
        <div class="shell__brand">
          <div class="shell__logo-menu">
            <button
              class="shell__logo-button"
              id="logo-menu-button"
              type="button"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <span class="shell__logo-wrap" aria-hidden="true">
                <img
                  src="{{ url_for('static', filename='img/onics-seal.svg') }}"
                  alt="ONICS seal"
                  class="shell__logo"
                />
              </span>
              <span class="shell__logo-caret" aria-hidden="true">▾</span>
            </button>
            <div class="shell__logo-dropdown" id="logo-menu" role="menu" aria-hidden="true">
              <button class="menu-action" type="button" id="reboot-btn">
                Restart vehicle
              </button>
            </div>
          </div>
          <div class="shell__stats" aria-label="System statistics">
            <div class="health-card shell__stat-card load-card">
              <h3>Load Avg</h3>
              <div class="load-graph load-graph--header" aria-hidden="true">
                <canvas id="header-load-graph" role="img" aria-label="System load history"></canvas>
              </div>
              <p class="health-card__value" id="header-load">n/a</p>
            </div>
            <div class="health-card shell__stat-card">
              <h3>Memory Free</h3>
              <p class="health-card__value" id="header-memory">n/a</p>
            </div>
            <div class="health-card shell__stat-card">
              <h3>Disk Free</h3>
              <p class="health-card__value" id="header-disk">n/a</p>
            </div>
          </div>
        </div>
        <div class="shell__status" id="connection-pill">LINK: INIT</div>
      </header>

      <section class="grid grid--primary">
        <article class="panel">
          <header class="panel__header">
            <h2>Command Deck</h2>
          </header>
          <div class="panel__body">
            <div class="button-row">
              <button class="btn btn--engage" id="engage-toggle-btn">ENGAGE</button>
            </div>
            <div class="status-strip" id="onics-state">
              <span class="status-strip__label">State</span>
              <strong class="status-strip__value">IDLE</strong>
              <span class="status-strip__meta" id="onics-runtime">SSH offline · last output n/a</span>
            </div>
          </div>
        </article>

        <article class="panel">
          <header class="panel__header panel__header--actions">
            <h2>Telemetry Log</h2>
            <button class="btn btn--ghost" id="clear-btn">Clear Logs</button>
          </header>
          <div class="panel__body panel__body--logs">
            <div class="log-view" id="log-view" role="log" aria-live="polite"></div>
          </div>
        </article>
      </section>

      <section class="pin-area">
          <div class="pin-area__controls">
            <h2>Pin Top Section</h2>
            <div class="pin-area__control">
              <label for="pin-section-select">Pinned</label>
              <select id="pin-section-select" class="pin-area__select">
                <option value="tailscale">Tailnet Health</option>
                <option value="system">System Resources</option>
                <option value="autopilot">Autopilot Telemetry</option>
              </select>
            </div>
          </div>
          <div class="pin-host" id="pin-host"></div>
        </section>

      <section class="toolbar-grid">
        <article class="panel" data-pin-section="autopilot" id="autopilot-section">
          <header class="panel__header">
            <h2>Vehicle Telemetry</h2>
          </header>
          <div class="panel__body">
            <div class="health-grid system-stats">
              <div class="health-card" id="tracking-card">
                <h3>Tracking Confidence</h3>
                <p class="health-card__value" id="tracking-confidence">Awaiting telemetry</p>
                <p class="health-card__meta" id="tracking-meta">No tracking updates yet.</p>
              </div>
              <div class="health-card" id="startup-card">
                <div class="health-card__header">
                  <h3>Startup Stage</h3>
                  <p class="startup-fails__value" id="startup-fails">0</p>
                </div>
                <p class="health-card__value" id="startup-stage">Awaiting telemetry</p>
                <p class="health-card__meta" id="startup-meta">No startup milestones yet.</p>
              </div>
              <div class="health-card" id="autopilot-card">
                <h3>Autopilot Alerts</h3>
                <p class="health-card__value" id="autopilot-alert">Awaiting telemetry</p>
                <p class="health-card__meta" id="autopilot-meta">No autopilot alerts yet.</p>
              </div>
            </div>
          </div>
        </article>

        <article class="toolbar" id="health-panel" data-pin-section="tailscale">
          <div class="toolbar__header">
            <h2>Tailnet Health</h2>
          </div>
          <div class="toolbar__items">
            <div class="health-card" id="tailscale-card">
              <h3>Tailscale</h3>
              <p class="health-card__value" id="tailscale-status">UNKNOWN</p>
              <p class="health-card__meta" id="tailscale-meta">Awaiting tailscale status.</p>
            </div>
            <div class="health-card" id="dns-card">
              <h3>MagicDNS</h3>
              <p class="health-card__value" id="dns-status">UNKNOWN</p>
              <p class="health-card__meta" id="dns-meta">Awaiting DNS.</p>
            </div>
            <div class="health-card" id="tcp-card">
              <h3>SSH Probe</h3>
              <p class="health-card__value" id="tcp-status">UNKNOWN</p>
              <p class="health-card__meta" id="tcp-meta">Awaiting TCP.</p>
            </div>
          </div>
        </article>

        <article class="panel">
          <header class="panel__header">
            <h2>Autopilot Health</h2>
          </header>
          <div class="panel__body">
            <div class="health-grid">
              <div class="health-card" id="arducopter-card">
                <div class="health-card__header">
                  <h3>Arducopter</h3>
                  <button class="btn btn--service" data-service-restart="arducopter">Restart</button>
                </div>
                <p class="health-card__value" id="arducopter-status">UNKNOWN</p>
                <p class="health-card__meta" id="arducopter-meta">Awaiting status.</p>
              </div>
              <div class="health-card" id="mavproxy-card">
                <div class="health-card__header">
                  <h3>MAVProxy</h3>
                  <button class="btn btn--service" data-service-restart="mavproxy">Restart</button>
                </div>
                <p class="health-card__value" id="mavproxy-status">UNKNOWN</p>
                <p class="health-card__meta" id="mavproxy-meta">Awaiting status.</p>
              </div>
              <div class="health-card" id="uplink-card">
                <div class="health-card__header">
                  <h3>Uplink</h3>
                  <div class="health-card__header-actions">
                    <p class="health-card__signal-value" id="uplink-signal-value">n/a</p>
                    <button class="btn btn--service" data-service-restart="uplink">Restart</button>
                  </div>
                </div>
                <p class="health-card__value" id="uplink-status">UNKNOWN</p>
                <p class="health-card__meta" id="uplink-signal-meta">Signal strength unavailable.</p>
                <p class="health-card__meta" id="uplink-meta">Awaiting status.</p>
              </div>
            </div>
            <div class="health-grid">
            </div>
          </div>
        </article>

        <article class="panel" data-pin-section="system" id="system-section">
          <header class="panel__header">
            <h2>System Resources</h2>
          </header>
          <div class="panel__body">
            <div class="health-grid">
              <div class="health-card load-card" id="system-load-card">
                <h3>System Load</h3>
                <div class="load-graph" aria-hidden="true">
                  <canvas
                    id="system-load-graph"
                    aria-label="System load history for the last 5 minutes"
                    role="img"
                  ></canvas>
                </div>
                <p class="health-card__value" id="system-load">-</p>
                <p class="health-card__meta" id="system-load-meta">CPU core count unavailable.</p>
              </div>
              <div class="health-card" id="system-memory-card">
                <h3>Memory</h3>
                <p class="health-card__value" id="system-memory">-</p>
                <p class="health-card__meta" id="system-memory-meta">Memory telemetry unavailable.</p>
              </div>
              <div class="health-card" id="system-disk-card">
                <h3>Disk</h3>
                <p class="health-card__value" id="system-disk">-</p>
                <p class="health-card__meta" id="system-disk-meta">Disk telemetry unavailable.</p>
              </div>
            </div>
          </div>
        </article>

      </section>
    </main>
  </body>
</html>
